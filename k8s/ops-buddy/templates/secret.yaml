apiVersion: v1
kind: Secret
metadata:
  name: {{ include "ops-buddy.fullname" . }}-secrets
  labels:
    {{- include "ops-buddy.labels" . | nindent 4 }}
type: Opaque
stringData:
  # LLM Configuration
  LLM_API_KEY: {{ .Values.llm.apiKey | quote }}
  {{- if .Values.langsmith.apiKey }}
  LANGSMITH_API_KEY: {{ .Values.langsmith.apiKey | quote }}
  {{- end }}
  # PostgreSQL
  POSTGRES_PASSWORD: {{ .Values.postgres.auth.password | quote }}
  DATABASE_URI: {{ printf "postgresql://%s:%s@%s-postgres:5432/%s" .Values.postgres.auth.username .Values.postgres.auth.password (include "ops-buddy.fullname" .) .Values.postgres.auth.database | quote }}
  # Jenkins (if enabled)
  {{- if .Values.jenkinsMcp.enabled }}
  JENKINS_USER: {{ .Values.jenkinsMcp.jenkins.user | quote }}
  JENKINS_PASSWORD: {{ .Values.jenkinsMcp.jenkins.password | quote }}
  {{- end }}
{{- if and .Values.clusterMonitor.enabled .Values.clusterMonitor.hive.kubeconfigContent }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.clusterMonitor.hive.kubeconfigSecretName }}
  labels:
    {{- include "ops-buddy.labels" . | nindent 4 }}
    app.kubernetes.io/component: cluster-monitor
type: Opaque
stringData:
  {{ .Values.clusterMonitor.hive.kubeconfigSecretKey }}: |
{{ .Values.clusterMonitor.hive.kubeconfigContent | indent 4 }}
{{- end }}
{{- if and .Values.clusterMonitor.enabled .Values.clusterMonitor.aws.credentialsContent }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.clusterMonitor.aws.credentialsSecretName }}
  labels:
    {{- include "ops-buddy.labels" . | nindent 4 }}
    app.kubernetes.io/component: cluster-monitor
type: Opaque
stringData:
  {{ .Values.clusterMonitor.aws.credentialsSecretKey }}: |
{{ .Values.clusterMonitor.aws.credentialsContent | indent 4 }}
{{- end }}

